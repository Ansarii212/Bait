<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>عقارات جدة</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: #f0f0f0;
      margin: 0;
      padding: 0;
      direction: rtl;
    }
    header {
      background: #7b4f2c;
      color: white;
      padding: 1rem;
      text-align: center;
      position: relative;
    }
    #logoutBtn {
      position: absolute;
      left: 10px;
      top: 10px;
      background: #fff;
      color: #7b4f2c;
      border: 1px solid #7b4f2c;
      border-radius: 6px;
      padding: 0.3rem 0.8rem;
      cursor: pointer;
      display: none;
    }
    .container {
      max-width: 800px;
      margin: auto;
      padding: 1rem;
    }
    .box {
      background: white;
      padding: 2rem;
      border-radius: 8px;
      margin-top: 1rem;
    }
    input, textarea {
      width: 100%;
      padding: 0.7rem;
      margin-bottom: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    button {
      padding: 0.7rem 1.5rem;
      background: #7b4f2c;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .property {
      background: white;
      padding: 1rem;
      margin-bottom: 1rem;
      border-left: 5px solid #7b4f2c;
      border-radius: 6px;
    }
    .property img {
      width: 100%;
      height: auto;
      max-height: 300px;
      object-fit: contain;
      border-radius: 6px;
      margin-bottom: 1rem;
    }
    #adminPanel, #listings, #registerBox {
      display: none;
    }
    .alert {
      color: red;
      margin-bottom: 1rem;
      text-align: center;
    }
  </style>
</head>
<body>
  <header>
    <h1>عقارات جدة</h1>
    <button id="logoutBtn" onclick="confirmLogout()">تسجيل الخروج</button>
    <div id="userPhone" style="margin-top: 5px;"></div>
  </header>

  <div class="container">

    <div class="box" id="loginBox">
      <h2>تسجيل الدخول</h2>
      <input type="text" id="phone" placeholder="أدخل رقم الجوال">
      <button onclick="login()" id="loginBtn">دخول</button>
      <div class="alert" id="loginAlert" style="display:none;">ليس لديك حساب. الرجاء التسجيل</div>
      <button onclick="showRegister()" id="showRegisterBtn" style="display:none;">تسجيل جديد</button>
    </div>

    <div class="box" id="registerBox">
      <h2>تسجيل مستخدم جديد</h2>
      <input type="text" id="regPhone" placeholder="أدخل رقم الجوال">
      <button onclick="register()">حفظ</button>
    </div>

    <div id="adminPanel" class="box">
      <h3>إضافة عقار جديد</h3>
      <input type="text" id="type" placeholder="نوع العقار (شقة، أرض، ...)">
      <input type="text" id="location" placeholder="الموقع">
      <input type="text" id="price" placeholder="السعر">
      <textarea id="desc" placeholder="وصف العقار"></textarea>
      <input type="text" id="image" placeholder="رابط الصورة">
      <button onclick="addProperty()">إضافة</button>
    </div>

    <div id="listings"></div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCr4T8GLRxtf_6LNrokjKvmBOwSkuGO5yQ",
      authDomain: "hamsa-6009e.firebaseapp.com",
      databaseURL: "https://hamsa-6009e-default-rtdb.firebaseio.com/",
      projectId: "hamsa-6009e",
      storageBucket: "hamsa-6009e.appspot.com",
      messagingSenderId: "998163671039",
      appId: "1:998163671039:web:d1930ea5b71a3a3fc729ca"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const loginBox = document.getElementById("loginBox");
    const registerBox = document.getElementById("registerBox");
    const adminPanel = document.getElementById("adminPanel");
    const listings = document.getElementById("listings");
    const logoutBtn = document.getElementById("logoutBtn");
    const loginAlert = document.getElementById("loginAlert");
    const showRegisterBtn = document.getElementById("showRegisterBtn");
    const userPhoneDiv = document.getElementById("userPhone");
    const loginBtn = document.getElementById("loginBtn");

    window.onload = function() {
      const storedPhone = localStorage.getItem("phone");
      if (storedPhone) {
        loginWithPhone(storedPhone);
      }
    };

    function clearInputs() {
      document.querySelectorAll("input, textarea").forEach(i => i.value = "");
    }

    function login() {
      const phone = document.getElementById("phone").value.trim();
      clearInputs();
      db.ref("users").once("value", snap => {
        const users = snap.val() || {};
        if (phone === "0534553706" || users[phone]) {
          localStorage.setItem("phone", phone);
          loginWithPhone(phone);
        } else {
          loginAlert.style.display = "block";
          showRegisterBtn.style.display = "inline-block";
          loginBtn.style.display = "none";
        }
      });
    }

    function loginWithPhone(phone) {
      loginBox.style.display = "none";
      registerBox.style.display = "none";
      logoutBtn.style.display = "inline-block";
      userPhoneDiv.innerText = "رقم المستخدم: " + phone;
      if (phone === "0534553706") {
        adminPanel.style.display = "block";
      }
      listings.style.display = "block";
      displayProperties();
    }

    function confirmLogout() {
      if (confirm("هل تريد تسجيل الخروج؟")) {
        localStorage.removeItem("phone");
        location.reload();
      }
    }

    function showRegister() {
      loginBox.style.display = "none";
      registerBox.style.display = "block";
      listings.style.display = "none";
    }

    function register() {
      const regPhone = document.getElementById("regPhone").value.trim();
      if (!regPhone) return;
      db.ref("users/" + regPhone).set(true, () => {
        alert("تم التسجيل بنجاح");
        registerBox.style.display = "none";
        loginBox.style.display = "block";
        document.getElementById("phone").value = regPhone;
        clearInputs();
      });
    }

    function addProperty() {
      const newProp = {
        type: document.getElementById("type").value,
        location: document.getElementById("location").value,
        price: document.getElementById("price").value,
        desc: document.getElementById("desc").value,
        image: document.getElementById("image").value
      };
      db.ref("properties").push(newProp, () => {
        alert("تمت الإضافة");
        clearInputs();
        displayProperties();
      });
    }

    function displayProperties() {
      listings.innerHTML = "<h3 style='margin-top:2rem;'>العقارات المتاحة</h3>";
      db.ref("properties").once("value", snap => {
        const props = [];
        snap.forEach(child => props.unshift(child.val()));
        props.forEach(p => {
          const div = document.createElement("div");
          div.className = "property";
          div.innerHTML = `
            <img src="${p.image}" alt="صورة العقار">
            <h4>${p.type}</h4>
            <p><strong>الموقع:</strong> ${p.location}</p>
            <p><strong>السعر:</strong> ${p.price}</p>
            <p>${p.desc}</p>
          `;
          listings.appendChild(div);
        });
      });
    }
  </script>
</body>
</html>
