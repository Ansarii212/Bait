<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>عقارات</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      direction: rtl;
      background: #f5f5f5;
    }
    .property {
      border: 2px dashed #aaa;
      padding: 15px;
      margin: 10px;
      background: #fff;
      border-radius: 10px;
    }
    .property img {
      width: 100%;
      max-width: 300px;
      display: block;
      margin-bottom: 10px;
      border-radius: 10px;
    }
    .share-btn {
      background: #007bff;
      color: white;
      padding: 5px 10px;
      border: none;
      border-radius: 5px;
      margin: 3px;
      cursor: pointer;
    }
    .share-btn.delete {
      background: red;
    }
  </style>
</head>
<body>

  <h2 style="text-align:center">قائمة العقارات</h2>
  <div id="properties-container"></div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDpK8DE3YrFqf_6_rHwe05fSeOCi2rVesQ",
      authDomain: "estate-9777c.firebaseapp.com",
      databaseURL: "https://estate-9777c-default-rtdb.firebaseio.com",
      projectId: "estate-9777c",
      storageBucket: "estate-9777c.appspot.com",
      messagingSenderId: "89337839429",
      appId: "1:89337839429:web:59f6ae1b6db6812f6815d1"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function displayProperties() {
      const container = document.getElementById("properties-container");
      container.innerHTML = "";

      db.ref("properties").once("value", snapshot => {
        snapshot.forEach(child => {
          const prop = child.val();
          const div = document.createElement("div");
          div.className = "property";

          div.innerHTML = `
            <img src="${prop.image}" alt="صورة العقار" id="img-${prop.code}">
            <input type="file" style="display:none;" onchange="previewImage(event, '${prop.code}')" id="upload-${prop.code}">
            <h4 contenteditable="false" id="type-${prop.code}">${prop.type}</h4>
            <p><strong>الحي:</strong> <span contenteditable="false" id="district-${prop.code}">${prop.district}</span></p>
            <p><strong>السعر:</strong> <span contenteditable="false" id="price-${prop.code}">${prop.price}</span></p>
            <p><strong>الوصف:</strong> <span contenteditable="false" id="desc-${prop.code}">${prop.desc}</span></p>
            <p><strong>الكود:</strong> ${prop.code} 
              <button class="share-btn" onclick="share('${prop.code}', '${prop.desc}')">مشاركة</button>
              <button class="share-btn delete" onclick="deleteProperty('${prop.code}')">حذف</button>
              <button class="share-btn" style="background:green;" onclick="enableEdit('${prop.code}')">تعديل</button>
              <button class="share-btn" style="background:orange; display:none;" id="save-${prop.code}" onclick="saveEdit('${prop.code}')">حفظ</button>
            </p>
          `;

          container.appendChild(div);
        });
      });
    }

    function share(code, desc) {
      const text = `شاهد هذا العقار (كود: ${code}): ${desc}`;
      if (navigator.share) {
        navigator.share({ text });
      } else {
        prompt("انسخ النص للمشاركة:", text);
      }
    }

    function deleteProperty(code) {
      if (!confirm("هل أنت متأكد أنك تريد حذف هذا العقار؟")) return;

      db.ref("properties").once("value", snapshot => {
        snapshot.forEach(child => {
          if (child.val().code === code) {
            db.ref("properties/" + child.key).remove().then(() => {
              alert("تم الحذف بنجاح");
              displayProperties();
            });
          }
        });
      });
    }

    function enableEdit(code) {
      document.getElementById(`type-${code}`).contentEditable = true;
      document.getElementById(`district-${code}`).contentEditable = true;
      document.getElementById(`price-${code}`).contentEditable = true;
      document.getElementById(`desc-${code}`).contentEditable = true;
      document.getElementById(`save-${code}`).style.display = "inline-block";
      document.getElementById(`upload-${code}`).style.display = "block";
    }

    function saveEdit(code) {
      const updatedType = document.getElementById(`type-${code}`).innerText.trim();
      const updatedDistrict = document.getElementById(`district-${code}`).innerText.trim();
      const updatedPrice = document.getElementById(`price-${code}`).innerText.trim();
      const updatedDesc = document.getElementById(`desc-${code}`).innerText.trim();
      const imgElement = document.getElementById(`img-${code}`);

      db.ref("properties").once("value", snapshot => {
        snapshot.forEach(child => {
          if (child.val().code === code) {
            db.ref("properties/" + child.key).update({
              type: updatedType,
              district: updatedDistrict,
              price: updatedPrice,
              desc: updatedDesc,
              image: imgElement.src
            }).then(() => {
              alert("تم حفظ التعديلات.");
              displayProperties();
            });
          }
        });
      });
    }

    function previewImage(event, code) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          document.getElementById(`img-${code}`).src = e.target.result;
        };
        reader.readAsDataURL(file);
      }
    }

    window.onload = displayProperties;
  </script>

</body>
</html>
